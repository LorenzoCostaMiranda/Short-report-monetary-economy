---
title: "Gráficos e Tabelas do Multiplicador"
author: "Lorenzo Costa Miranda"
date: "2024-03-24"
output: 
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: true
    toc_depth: 4
---


```{r include=FALSE, message=FALSE, warning=FALSE}
library(zoo)
library(plotly)
library(htmltools)
library(GetBCBData)
library(dplyr)
library(pandoc)
library(ggplot2)
library(tibble)
library(tidyr)
library(kableExtra)
library(flextable)
library(openxlsx)
library(scales)
library(reshape2)
library(patchwork)
library(corrplot)
```

### Tabela Dos Coeficientes

```{r include=FALSE, message=FALSE, warning=FALSE}
##Pegando os dados necessários pelo ID 


#reservas bancárias =/ Encaixes Totais
TabelaResBan <- GetBCBData::gbcbd_get_series(
  id =  1787,
  first.date = "2003-01-01",
  last.date = "2023-12-01"
)

#Papel Moeda no Poder Público

TabelaPMPP <- GetBCBData::gbcbd_get_series(
  id = 27789 ,
  first.date = "2003-01-01",
  last.date = "2023-12-01"
)


#Base monetária

TabelaBASE <- GetBCBData::gbcbd_get_series(
  id =  1788,
  first.date = "2003-01-01",
  last.date = "2023-12-01"
)


#Depósitos à vista
TabelaDepAvi <- GetBCBData::gbcbd_get_series(
 id =  27790,
 first.date = "2003-01-01",
 last.date = "2023-12-01"
)

#Meios de pagamento = PMPP + DV (TOTAL DE M1)
TabelaMP <- GetBCBData::gbcbd_get_series(
  id = 27791,
  first.date = "2003-01-01",
  last.date = "2023-12-01"
)

#M1
TabelaM1 <- GetBCBData::gbcbd_get_series(
  id = 27791,
  first.date = "2003-01-01",
  last.date = "2023-12-01"
)

#M2
TabelaM2 <- GetBCBData::gbcbd_get_series(
  id = 27810,
  first.date = "2003-01-01",
  last.date = "2023-12-01"
)

#M3
TabelaM3 <- GetBCBData::gbcbd_get_series(
  id = 27813,
  first.date = "2003-01-01",
  last.date = "2023-12-01"
)

#M4
TabelaM4 <- GetBCBData::gbcbd_get_series(
  id = 27815,
  first.date = "2003-01-01",
  last.date = "2023-12-01"
)

#IPCA
TabelaIPCA <- GetBCBData::gbcbd_get_series(
  id = 433,
  first.date = "2003-01-01",
  last.date = "2023-12-01"
)

#Taxa Selic

TabelaSELIC <- GetBCBData::gbcbd_get_series(
  id = 4189,
  first.date = "2003-01-01",
  last.date = "2023-12-01"
)

#Puxando a Tabela de PIB e tratando-a

dados_pib <- read.xlsx("C:/Users/Lorenzo Costa/Desktop/Trabalhos/Economia Monetaria/multiplicadorpt2/tabelaPIB.xlsx", sheet = "Tabela")

anos <- seq(2003,2021, by = 1)
print(anos, max.print = Inf)

vetorPIB <- as.numeric(dados_pib[4, -1])
print(vetorPIB, max.print = Inf)

vetor_PIB <-format(vetorPIB, big.mark = ".", decimal.mark = ",", scientific = FALSE)



TabelaPIB <- tibble(Data = anos, "PIB valores correntes(milhões)" = vetor_PIB)

TabelaPIB$`PIB valores correntes(milhões)` <- as.numeric(gsub("\\.", "", TabelaPIB$`PIB valores correntes(milhões)`))


diffPIB <- diff(TabelaPIB$`PIB valores correntes(milhões)`)
porcentoPIB <- (diffPIB / head(TabelaPIB$`PIB valores correntes(milhões)`, -1)) * 100
PIBvari <- c(NA, porcentoPIB)

TabelaPIB <- TabelaPIB %>%
  add_column("Variação Percentual (%)" = PIBvari, .after = "PIB valores correntes(milhões)")

#Repetir para que o PIB volte a ser numérico novamente


```

```{r echo = FALSE, message=FALSE, warning=FALSE}

### Criando um vetor para ser a coluna de tempo
dates <- seq.Date(from = as.Date("2003-01-01"), to = as.Date("2023-12-01"), by = "month")


#criando vetores das tabelas (não terá o vetor PIB - ja foi criado anteriormente)
vetormp <- TabelaMP[[2]]
vetordepavi <- TabelaDepAvi[[2]]
vetorresban <- TabelaResBan[[2]]
vetorPPMP <- TabelaPMPP[[2]]
vetorBASE <- TabelaBASE[[2]]
vetorM1 <- TabelaM1[[2]]
vetorM2 <- TabelaM2[[2]]
vetorM3 <- TabelaM3[[2]]
vetorM4 <- TabelaM4[[2]]
vetorIPCA <- TabelaIPCA[[2]]

vetorSELIC <- TabelaSELIC[[2]]

#formatando os vetores

vetor_mp <- format(vetormp, big.mark = ".", decimal.mark = ",", scientific = FALSE)
vetor_depavi <- format(vetordepavi, big.mark = ".", decimal.mark = ",", scientific = FALSE)
vetor_resban <- format(vetorresban, big.mark = ".", decimal.mark = ",", scientific = FALSE)
vetor_PPMP <- format(vetorPPMP, big.mark = ".", decimal.mark = ",", scientific = FALSE)
vetor_BASE <- format(vetorBASE, big.mark = ".", decimal.mark = ",", scientific = FALSE)
vetor_M1 <- format(vetorM1, big.mark = ".", decimal.mark = ",", scientific = FALSE)
vetor_M2 <- format(vetorM2, big.mark = ".", decimal.mark = ",", scientific = FALSE)
vetor_M3 <- format(vetorM3, big.mark = ".", decimal.mark = ",", scientific = FALSE)
vetor_M4 <- format(vetorM4, big.mark = ".", decimal.mark = ",", scientific = FALSE)


```

```{r echo=FALSE, message=FALSE, warning=FALSE}
#criação das séries temporais

###SABEMOS QUE B = PMPP + ENCAIXES TOTAIS / LOGO ENCAIXES TOTAIS = B - PMPP

#Função de subtração

Z <- function(s, t){
      Resultado = s - t
      return(Resultado)
}


#criando um vetor com os encaixes técnicos

VetorEncaixe <- mapply(Z, TabelaBASE[[2]], TabelaPMPP[[2]])

#Tabela do vetor de encaxe

TabelaEncaixe <- tibble(Data = dates, Valor = VetorEncaixe)

#Formatando o vetor_encaixe

Vetor_Encaixe <- format(VetorEncaixe, big.mark = ".", decimal.mark = ",", scientific = FALSE)


### juntando todas os dados monetários em uma tabela só

TabelaCoeficientes <- tibble(Data = dates, "Meios de Pagamentos" = vetor_mp, 
            "Depositos a vista" = vetor_depavi, "Encaixes Totais" = Vetor_Encaixe)




# Criando função para realizar o cálculo do coeficiente
X <- function(x,y){
  Resultado = x/y
  return(Resultado)
}

#Fazendo os cálculos do coeficiente "e" e "d" entre colunas de dois dataframes diferentes. 

Coeficiente_e <- mapply(X, TabelaEncaixe[[2]], TabelaDepAvi[[2]])

Coeficiente_d <- mapply(X, TabelaDepAvi[,2], TabelaMP[,2])


# Criando dois tibbles para as séries temporais de "e" e "d"

SerieTemporal_e <- tibble(data = dates, valor = Coeficiente_e)
SerieTemporal_d <- tibble(data = dates, valor = Coeficiente_d)

#Criando a função de multiplicador monetário

y <- function(d,e){
  Resultado = 1/(1-d * (1-e))
  return(Resultado)
}

# Criando uma tible com todos os 2 coeficientes 

Coeficientes <- tibble(data = dates, Valor_de_e = Coeficiente_e, Valor_de_d = Coeficiente_d)

# Fazendo o cálculo do multiplicador bancário entre colunas de dois dataframes e fazendo o gráfico dele.

Multiplicador_mon <- mapply(y, Coeficientes[,3], Coeficientes[,2])
SerieTemporal_alpha <- tibble(data = dates, valor = Multiplicador_mon)


```


```{r echo=FALSE, message=FALSE, warning=FALSE}

# Adicionando colunas a uma tabela com TODOS os coeficientes. 

TabelaCoeficientes <- TabelaCoeficientes %>%
  add_column(e = Coeficiente_e, d = Coeficiente_d, alpha = Multiplicador_mon, .after = "Encaixes Totais", .name_repair = "unique")

kable(TabelaCoeficientes, format = "html", longtable = TRUE, booktabs = TRUE, caption = "Valores dos Coeficientes no Tempo") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))


```
<br><br>


#### Estatística dos Coeficientes

```{r echo = FALSE, message = FALSE, warning = FALSE}
#Criando a tibble dos Agregados Monetários, IPCA e PIB, mas só futuramente será exibida no arquivo html

TabelaAgregados <- tibble( Data = dates, "M1" = vetor_M1, "M2" = vetor_M2, "M3" = vetor_M3,
                           "M4" = vetor_M4,"IPCA" = vetorIPCA, "SELIC" = vetorSELIC)


#Transformando (retomando) os restantes das colunas em variáveis numéricas (fazer isso após a exibição da tabela em html)
#Só é possível utilizar o summary e o sapply em variáveis numéricas.

TabelaCoeficientes$`Meios de Pagamentos` <- as.numeric(gsub("\\.", "", TabelaCoeficientes$`Meios de Pagamentos`))
TabelaCoeficientes$`Depositos a vista` <- as.numeric(gsub("\\.", "", TabelaCoeficientes$`Depositos a vista`))
TabelaCoeficientes$`Encaixes Totais` <- as.numeric(gsub("\\.", "", TabelaCoeficientes$`Encaixes Totais`))

###Criação das estatísticas TabelaCoeficientes
#summary(TabelaCoeficientes)
#sapply(TabelaCoeficientes, sd)

vetorestat <- c("Max", "Min", "Mean", "sd")

vetorestatVARI <- c("Max", "Min", "Mean", "sd", "HighestVariance(%)", "LowestVariance(%)")

estatMP <- c("653.420.212", "86.231.763", "311.848.406", "160.128.500")
estatDP <- c("367.475.256", "53.712.908", "167.699.479", "81.515.370")
estatET <- c("146.023.783", "23.635.669", "75.386.077", "29.872.300")
estatE <- c("0.6510", "0.3354", "0.4659", "0.05429921")
estatD <- c("0.6508", "0.4640", "0.5556", "0.05787693")
estatalpha <- c("1.6045311", "1.2424243", "1.4262363", " 0.08183064")

TabelaEstatCoe <- tibble(Estatística = vetorestat, "Meios de Pagamentos" = estatMP, "Depositos a vista" = estatDP,
                         "Encaixes Totais" = estatET, "e" = estatE, "d" = estatD, "alpha" = estatalpha)

kable(TabelaEstatCoe, format = "html", booktabs = TRUE) %>%
  kable_styling(bootstrap_options = c( "hover", "condensed", "responsive"))

```
<br><br>



#### Gráficos dos Coeficientes

```{r echo=FALSE, fig.cap = "Plot da Série Temporal do Coeficiente \"e\"", fig.pos = 'H'}

ggplot(data = SerieTemporal_e) +
       aes(x = data, y = valor) +
       geom_line(colour = "red") +
       labs(x = "Data", y = "Coeficiente 'e'") +
       geom_point(colour = "black") +
  theme_minimal()

```

```{r echo=FALSE, fig.cap = "Plot da Série Temporal do Coeficiente \"d\""}

ggplot(data = SerieTemporal_d) +
  aes(x = data, y = valor) +
  geom_line(colour = "blue") +
  labs(x = "Data", y = "Coeficiente 'd'") +
  geom_point(colour = "black") +
  theme_minimal()

```

```{r echo=FALSE, fig.cap = "Plot da Série Temporal dos Coeficientes \"e\" e \"d\""}

ggplot(data = Coeficientes) +
  aes(x = data, y = Valor_de_e, color = "Valor_de_e") +
  geom_line() +
  geom_line(aes(y = Valor_de_d, color = "Valor_de_d")) +
  labs(x = "Data", y = "Valores dos coeficientes") +
  scale_color_manual(values = c("Valor_de_e" = "red", "Valor_de_d" = "blue")) +
  theme_minimal()

```
```{r echo = FALSE, fig.cap = "Plot Série Temporal do Multiplicador Monetário"}

ggplot(data = SerieTemporal_alpha, aes( x = data, y = valor)) +
  geom_line(colour = "purple") +
  labs(x = "Data", y = "alpha") +
  geom_point(colour = "black") +
  theme_minimal() 

```


```{r echo = FALSE, message=FALSE, warning=FALSE, fig.cap= "Plot Série Temporal dos Coeficientes e Multiplicador"}

ggplot(data = TabelaCoeficientes) +
  aes(x = Data, y = e, color = "e") +
  geom_line() +
  geom_line(aes(y = d, color = "d")) +
  geom_line(aes(y = alpha, color = "alpha")) +
  labs(x = "Data", y = "Valores") +
  scale_color_manual(values = c("e" = "red", "d" = "blue", "alpha" = "purple")) +
  theme_minimal()

```
### Tabela dos Agregados Monetários, Taxa Selic e PIB

```{r echo = FALSE, message = FALSE, warning = FALSE, results = 'asis'}
kable(TabelaAgregados, format = "html", longtable = TRUE, booktabs = TRUE, caption = "Valores dos Agregados e Selic") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))


kable(TabelaPIB, format = "html", booktabs = TRUE, caption = "Valores do PIB") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

```

<br><br>


```{r echo = FALSE, message = FALSE, warning = FALSE}
#str(TabelaAgregados$M1)
#sapply(TabelaAgregados, class)

# retirando os "." para milhares e reformatando para voltarem a ser variáveis numéricas. IPCA e SELIC já vieram com
#separadores de decimais e já são consideradas numerics naturalmente, então não precisa. 

TabelaAgregados$M1 <- as.numeric(gsub("\\.", "", TabelaAgregados$M1))
TabelaAgregados$M2 <- as.numeric(gsub("\\.", "", TabelaAgregados$M2))
TabelaAgregados$M3 <- as.numeric(gsub("\\.", "", TabelaAgregados$M3))
TabelaAgregados$M4 <- as.numeric(gsub("\\.", "", TabelaAgregados$M4))
TabelaPIB$`PIB valores correntes(milhões)` <- as.numeric(gsub("\\.", "", TabelaPIB$`PIB valores correntes(milhões)`))

#

```
#### Variação Percentual dos Agregados

```{r echo = FALSE, message = FALSE, warning = FALSE}

#Criação das variações no tempo dos agregados

diffM1 <- diff(TabelaAgregados$M1)
percentoM1 <- (diffM1 / head(TabelaAgregados$M1, -1)) * 100
M1vari <- c(NA, percentoM1)

diffM2 <- diff(TabelaAgregados$M2)
percentoM2 <- (diffM2 / head(TabelaAgregados$M2, -1)) * 100
M2vari <- c(NA, percentoM2)

diffM3 <- diff(TabelaAgregados$M3)
percentoM3 <- (diffM3 / head(TabelaAgregados$M3, -1)) * 100
M3vari <- c(NA, percentoM3)

diffM4 <- diff(TabelaAgregados$M4)
percentoM4 <- (diffM4 / head(TabelaAgregados$M4, -1)) * 100
M4vari <- c(NA, percentoM4)

diffIPCA <- diff(TabelaAgregados$IPCA)
percentoIPCA <- (diffIPCA / head(TabelaAgregados$IPCA, -1)) * 100
IPCAvari <- c(NA, percentoIPCA)

diffSELIC <- diff(TabelaAgregados$SELIC)
percentoSELIC <- (diffSELIC / head(TabelaAgregados$SELIC, -1)) * 100
SELICvari <- c(NA, percentoSELIC)

#Criação da Tabela das variações percentuais

VariacoesPercentuais <- tibble(Data = dates, "M1 (%)" = M1vari, "M2 (%)" = M2vari, "M3 (%)" = M3vari, "M4 (%)" = M4vari,
                               "IPCA (%)" = IPCAvari, "SELIC (%)" = SELICvari)
#Criação da Tabela em HTML

kable(VariacoesPercentuais, format = "html", booktabs = TRUE) %>%
  kable_styling(bootstrap_options = c( "hover", "condensed", "stripped"))

```

#### Estatística dos Agregados Monetários

```{r echo = FALSE, message = FALSE, warning = FALSE}
#TabelaAgregados$SELIC <- as.numeric(sub(",", ".", gsub("\\.", "", TabelaAgregados$SELIC), fixed = TRUE))
#
#Criando a Tabela de estatística para A TabelaAgregados, que já são numéricos. (só é possível tirar essa estatística de valores numéricos)

#sapply(TabelaAgregados, class)

#summary(TabelaAgregados)
#sapply(TabelaAgregados, sd)
#summary(TabelaPIB)
#sapply(TabelaPIB, sd)

#max(VariacoesPercentuais$M1, na.rm = TRUE)
#max(VariacoesPercentuais$M2, na.rm = TRUE)
#max(VariacoesPercentuais$M3, na.rm = TRUE)
#max(VariacoesPercentuais$M4, na.rm = TRUE)
#max(TabelaPIB$`Variação Percentual`, na.rm = TRUE)
#max(TabelaAgregados$IPCA)
#min(VariacoesPercentuais$M1, na.rm = TRUE)
#min(VariacoesPercentuais$M2, na.rm = TRUE)
#min(VariacoesPercentuais$M3, na.rm = TRUE)
#min(VariacoesPercentuais$M4, na.rm = TRUE)
#min(TabelaPIB$`Variação Percentual`, na.rm = TRUE)
#min(TabelaAgregados$IPCA)

#min(VariacoesPercentuais$`IPCA (%)`[is.finite(VariacoesPercentuais$`IPCA (%)`)], na.rm = TRUE)

estatM1 <- c("653.420.212", "86.231.763", "311.848.406", "160.128.500", "22.87 (2007-12)", "-17.58 (2008-01)")
estatM2 <- c("5.913.000.000", "385.500.000", "2.066.000.000", "1.407.171.000", "6.36 (2007-12)", "-3.12 (2008-01)")
estatM3 <- c("10.860.000.000", "696.100.000", "4.239.000.000", "2.822.259.000", "5.73 (2010-01)", "-1.26 (2019-01)")
estatM4 <- c("11.950.000.000", "810.300.000", "4.616.000.000", "3.046.371.000", " 4.49 (2007-09)", "-0.87 (2019-01)")
estatPIB <- c("9.012.142", "1.717.950", "4.814.316", "2.182.850", "18.43 (2021)", "2.98 (2020)")
estatIPCA <- c("2.250 (2003-01)" , "-0.680 (2022-07)", "0.450", "0,3563829", "2400 (2014-08)" ,"-1350 (2005-07)")
estatSELIC <- c("26.32 (2003-03)", "1.90 (2020-12)", "11.44", "4.863212", "-17.53 (2020-05)", "24.15 (2021-05)")

TabelaEstatAg <- tibble(Estatística = vetorestatVARI, M1 = estatM1, M2 = estatM2, M3 = estatM3, M4 = estatM4,
                        PIB = estatPIB, IPCA = estatIPCA, SELIC = estatSELIC)
kable(TabelaEstatAg, format = "html", longtable = TRUE, booktabs = TRUE) %>%
  kable_styling(bootstrap_options = c( "stripped", "hover", "condensed"), font_size = 12)

```

```{r, echo = FALSE, message = FALSE, warning = FALSE, results='hide'}

#Colocando os valores em decimais para fazer o cálculo da média móvel

#sapply(TabelaAgregados, class)
TabelaAgregados <- as.data.frame(TabelaAgregados)

  

#Fazendo a média móvel (12meses)
TabelaAgregados$rollmeanIPCA <- rollmean(TabelaAgregados$IPCA, 12, fill = NA, align = 'right')
TabelaAgregados$rollmeanSELIC <- rollmean(TabelaAgregados$SELIC, 12, fill = NA, align = 'right')

TabelaAgregados$rollmeanIPCA3 <- rollmean(TabelaAgregados$IPCA, 3, fill = NA, align = 'right')
TabelaAgregados$rollmeanSELIC3 <- rollmean(TabelaAgregados$SELIC, 3, fill = NA, align = 'right')



```  
  
<br><br>


#### Gráficos dos Agregados Monetários, Taxa Selic e PIB


```{r echo = FALSE, message = FALSE, warning=FALSE}

ggplot(data = TabelaAgregados) +
  geom_line(aes( x = Data, y = rollmeanIPCA, color = "rollmeanIPCA")) +
  geom_line(aes( x = Data, y = IPCA, color = "IPCA")) +
  labs(x = "Data", y = "Valores", title = "Média Móvel de 12 meses do IPCA") +
  scale_color_manual(values = c("rollmeanIPCA" = "purple2", "IPCA" = "pink")) +
  theme_minimal()


#colors()
```
<br><br>



```{r echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Plot Série Temporal dos Agregados Monetários"}
# Gráfico conjunto dos agregados monetários
#colors()

ggplot(data = TabelaAgregados, aes(x = Data, y = M1, color = "M1")) +
  geom_line() +
  geom_line(aes(y = M2, color = "M2")) +
  geom_line(aes(y = M3, color = "M3")) +
  geom_line(aes(y = M4, color = "M4")) +
  labs(x = "Data", y = "Valores", title = "Série Temporal dos Agregados Monetários") +
  scale_color_manual(values = c("M1" = "green", "M2" = "lawngreen", "M3" = "yellow", "M4" = "orange")) +
  scale_y_continuous(labels = label_number(big.mark = ".", decimal.mark = ",")) +
  theme_minimal()
      

```

<br><br>


```{r echo = FALSE, message = FALSE, warning = FALSE, fig.width=14, fig.height=12, out.width='100%'}



# criando multiplos ggplots
# Formatando os próximos plots para saírem embutidos:
par(mfrow = c(2, 2), oma = c(0, 0, 6, 0))



#Criando uma gráfico plot com M1 e SELIC

plot(TabelaAgregados$Data, TabelaAgregados$M1, type = "l",
     col = "green", ylim = c(min(TabelaAgregados$M1),
                             max(TabelaAgregados$M1)),
     ylab = "M1", xlab = "Data", cex.lab = 2.0, cex.axis = 1.5)

#sobrepondo esse gráfico com outro plot para a taxa selic

par(new = TRUE)
plot(TabelaAgregados$Data, TabelaAgregados$SELIC, type = "l",
     col = "cyan", axes = FALSE, xlab = "", ylab = "",
     ylim = c(min(TabelaAgregados$SELIC),
              max(TabelaAgregados$SELIC)))

#Criando um segundo eixo y para a taxa selic
axis(side = 4, at = pretty(range(TabelaAgregados$SELIC)))
mtext("Taxa Selic (%)", side = 4, line = 3)



### Fazendo o mesmo para M2 e SELIC

plot(TabelaAgregados$Data, TabelaAgregados$M2, type = "l",
    col = "lawngreen", ylim = c(min(TabelaAgregados$M2),
                                max(TabelaAgregados$M2)),
    ylab = "M2", xlab = "Data", cex.lab = 2.0, cex.axis = 1.5)
par(new = TRUE)
plot(TabelaAgregados$Data, TabelaAgregados$SELIC, type = "l",
     col = "cyan", axes = FALSE, xlab = "", ylab = "",
     ylim = c(min(TabelaAgregados$SELIC),
              max(TabelaAgregados$SELIC)))
axis(side =  4, at = pretty(range(TabelaAgregados$SELIC)))
mtext("Taxa Selic (%)", side = 4, line = 3)

# Fazendo o mesmo para M3 e SELIC

plot(TabelaAgregados$Data, TabelaAgregados$M3, type = "l",
     col = "yellow", ylim = c(min(TabelaAgregados$M3),
                              max(TabelaAgregados$M3)),
     ylab = "M3", xlab = "Data", cex.lab = 2.0, cex.axis = 1.5)
par(new = TRUE)
plot(TabelaAgregados$Data, TabelaAgregados$SELIC, type = "l",
     col = "cyan", axes = FALSE, xlab = "", ylab = "",
     ylim = c(min(TabelaAgregados$SELIC),
              max(TabelaAgregados$SELIC)))
axis(side =  4, at = pretty(range(TabelaAgregados$SELIC)))
mtext("Taxa Selic (%)", side = 4, line = 3)

# Fazendo o mesmo para M4 e SELIC

plot(TabelaAgregados$Data, TabelaAgregados$M4, type = "l",
     col = "orange", ylim = c(min(TabelaAgregados$M4),
                              max(TabelaAgregados$M4)),
     ylab = "M4", xlab = "Data", cex.lab = 2.0, cex.axis = 1.5)
par(new = TRUE)
plot(TabelaAgregados$Data, TabelaAgregados$SELIC, type = "l",
     col = "cyan", axes = FALSE, xlab = "", ylab = "",
     ylim = c(min(TabelaAgregados$SELIC),
              max(TabelaAgregados$SELIC)))
axis(side =  4, at = pretty(range(TabelaAgregados$SELIC)))
mtext("Taxa Selic (%)", side = 4, line = 3)

par(mfrow = c(1,1))

mtext("Comparação Entre os Agregados e a Selic", outer = TRUE, cex = 1.5, line = 2)

```
<br><br>


```{r echo = FALSE, message=FALSE, warning=FALSE, fig.width=4, fig.height=4, out.width='100%'}
#Criando Tabela de Correlação entre os Agregados monetários e a Taxa Selic

#sapply(TabelaPIB, class)

#  add_lines(data = TabelaAgregados, x = ~Data, y = ~IPCA, name = "IPCA", color = I("pink"),
            #yaxis = "y2")


#Criando uma gráfico plotly com M1 e IPCA

p1 <- plot_ly() %>%
  add_lines(data = TabelaAgregados, x = ~Data, y = ~M1, name = "M1", color = I("green")) %>%
  add_lines(data = TabelaAgregados, x = ~Data, y = ~rollmeanIPCA, name = "Média Móvel de 12 meses", color = I('purple2'),
            yaxis = "y2")

p1 <- p1 %>%
  layout(
    title = "M1 em relação ao IPCA",
    yaxis = list(title = "M1"),
    yaxis2 = list(
      title = "IPCA",
      overlaying = "y",
      side = "right"
    )
  )

p1

# Fazendo o mesmo para M2 e IPCA

p2 <- plot_ly() %>%
  add_lines(data = TabelaAgregados, x = ~Data, y = ~M2, name = "M2", color = I("lawngreen")) %>%
  add_lines(data = TabelaAgregados, x = ~Data, y = ~rollmeanIPCA, name = "Média Móvel de 12 meses", color = I('purple2'),
            yaxis = "y2")

p2 <- p2 %>%
  layout(
    title = "M2 em relação ao IPCA",
    yaxis = list(title = "M2"),
    yaxis2 = list(
      title = "IPCA",
      overlaying = "y",
      side = "right"
    )
  )

p2

# Fazendo o mesmo para M3 e IPCA


p3 <- plot_ly() %>%
  add_lines(data = TabelaAgregados, x = ~Data, y = ~M3, name = "M3", color = I("yellow")) %>%
  add_lines(data = TabelaAgregados, x = ~Data, y = ~rollmeanIPCA, name = "Média Móvel de 12 meses", color = I('purple2'),
            yaxis = "y2")

p3 <- p3 %>%
  layout(
    title = "M3 em relação ao IPCA",
    yaxis = list(title = "M3"),
    yaxis2 = list(
      title = "IPCA",
      overlaying = "y",
      side = "right"
    )
  )

p3

# Fazendo o mesmo para M4 e IPCA



p4 <- plot_ly() %>%
  add_lines(data = TabelaAgregados, x = ~Data, y = ~M4, name = "M4", color = I("orange")) %>%
  add_lines(data = TabelaAgregados, x = ~Data, y = ~rollmeanIPCA, name = "Média Móvel de 12 meses", color = I('purple2'),
            yaxis = "y2")

p4 <- p4 %>%
  layout(
    title = "M4 em relação ao IPCA",
    yaxis = list(title = "M4"),
    yaxis2 = list(
      title = "IPCA",
      overlaying = "y",
      side = "right"
    )
  )

p4

```
<br><br>

```{r, echo=FALSE, message=FALSE, warning=FALSE}

colnames(TabelaPIB)[colnames(TabelaPIB) == "PIB valores correntes(milhões)"] <- "PIB_Valores_Correntes_milhoes"


Plotpib <- plot_ly() %>%
    add_lines(data = TabelaAgregados, x = ~Data, y = ~M1, name = "M1", color = I("green")) %>%
  add_lines(data = TabelaAgregados, x = ~Data, y = ~M2, name = "M2", color = I("lawngreen")) %>%
  add_lines(data = TabelaAgregados, x = ~Data, y = ~M3, name = "M3", color = I("yellow")) %>%
  add_lines(data = TabelaAgregados, x = ~Data, y = ~M4, name = "M4", color = I("orange")) %>%
  add_lines(data = TabelaPIB, x = ~Data, y = ~PIB_Valores_Correntes_milhoes, name = "PIB valores correntes(milhões)", yaxis = "y2", color = I("darkblue"))

# Configuração do layout com múltiplos eixos Y
Plotpib <- Plotpib %>%
  layout(
    autosize = F, # Desativa o dimensionamento automático
    width = 800,  # Largura do gráfico em pixels
    height = 600, # Altura do gráfico em pixels
    margin = list(l = 50, r = 50, b = 100, t = 100, pad = 4),
    title = "PIB e os Agregados Monetários",
    yaxis = list(title = "Agregados Monetários (M1, M2, M3, M4)"),
    yaxis2 = list(
      title = "PIB",
      overlaying = "y",
      side = "right",
      anchor = "free",
      position = 1.00
    )
  )

# Renderização do gráfico
Plotpib
```

<br><br>

<br><br>


```{r echo=FALSE, message=FALSE, warning=FALSE}

p <- plot_ly() %>%
  add_lines(data = TabelaAgregados, x = ~Data, y = ~SELIC, name = "SELIC", color = I("cyan")) %>%
  add_lines(data = TabelaPIB, x = ~Data, y = ~PIB_Valores_Correntes_milhoes, name = "PIB",
            yaxis = 'y2', color = I("darkblue"))

p <- p %>%
  layout(
    title = "Gráfico do PIB em relação à SELIC",
    yaxis = list(title = "SELIC"),
    yaxis2 = list(
      title = "PIB Valores Correntes (milhões)",
      overlaying = "y",
      side = "right"
    )
  )

p


```

```{r echo = FALSE, message = FALSE, warning= FALSE}

p5 <- plot_ly() %>%
  add_lines(data = TabelaAgregados, x = ~Data, y = ~rollmeanSELIC, name = "Média Móvel SELIC", color = I('cyan4')) %>%
  add_lines(data = TabelaAgregados, x = ~Data, y = ~rollmeanIPCA, name = "Média Móvel IPCA", color = I('purple2'),
            yaxis = 'y2')

p5 <- p5 %>%
  layout(
    title = "Comparação entre as médias móveis de 12 meses do IPCA e da SELIC",
    yaxis = list(title = "SELIC"),
    yaxis2 = list(
      title = "IPCA",
      overlaying = "y",
      side = "right"
    )
  )

p5



```

<br><br>
<br><br>

```{r echo=FALSE, message=FALSE, warning=FALSE, results = 'hide'}
write.xlsx(TabelaCoeficientes, "C:/Users/Lorenzo Costa/Desktop/Trabalhos/Economia Monetária/multiplicadorpt2/Tabela Coeficientes xslx")
  
```

### Análise Específica

<br><br>

#### Estatística dos Coeficientes

<br><br>

```{r echo = FALSE, message = FALSE, warning = FALSE}

ImpcAgre <- TabelaAgregados %>%
  slice(150:161)

impcPib <- TabelaPIB %>%
  slice(12:14)


```
<br><br>
<br><br>

#### Gráficos dos Coeficientes

<br><br>

```{r echo = FALSE, message = FALSE, warning = FALSE}


Pipca <- plot_ly() %>%
  add_lines( data = ImpcAgre, x = ~Data, y = ~IPCA, name = "IPCA",
             color = I("pink")) %>%
  add_lines(data = ImpcAgre, x = ~Data, y = ~rollmeanIPCA3, name = "Média Móvel IPCA de 3 meses", color = I("purple2"))

Pipca <- Pipca %>%
  layout(
    title = "Média Móvel de 3 Meses do IPCA no Período de Análise",
    yaxis = list(title = "Valores IPCA")
    )

Pipca


Pagremon1 <- plot_ly() %>%
  add_lines(data = ImpcAgre, x = ~Data, y = ~M1, name = "M1", color = I("green"))

Pagremon1 <- Pagremon1 %>%
   layout(
    title = "Série Temporal dos Agregados Monetários",
    yaxis = list(title = "Valores de M1")
    )

Pagremon1

Pagremon2 <- plot_ly() %>%
  add_lines(data = ImpcAgre, x = ~Data, y = ~M2, name = "M2", color = I("lawngreen")) 

Pagremon2 <- Pagremon2 %>%
   layout(
    title = "Série Temporal dos Agregados Monetários",
    yaxis = list(title = "Valores de M2")
    )

Pagremon2


Pagremon3 <- plot_ly() %>%
  add_lines(data = ImpcAgre, x = ~Data, y = ~M3, name = "M3", color = I("yellow"))


Pagremon3 <- Pagremon3 %>%
   layout(
    title = "Série Temporal dos Agregados Monetários",
    yaxis = list(title = "Valores de M3")
    )

Pagremon3

Pagremon4 <- plot_ly() %>%
  add_lines(data = ImpcAgre, x = ~Data, y = ~M4, name = "M4", color = I("orange"))

Pagremon4 <- Pagremon4 %>%
   layout(
    title = "Série Temporal dos Agregados Monetários",
    yaxis = list(title = "Valores de M4")
    )

Pagremon4



```

```{r echo = FALSE, message=FALSE, warning = FALSE, fig.width=14, fig.height=12, out.width='100%'}



# criando multiplos ggplots
# Formatando os próximos plots para saírem embutidos:
par(mfrow = c(2, 2), oma = c(0, 0, 6, 0))



#Criando uma gráfico plot com M1 e SELIC

plot(ImpcAgre$Data, ImpcAgre$M1, type = "l",
     col = "green", ylim = c(min(ImpcAgre$M1),
                             max(ImpcAgre$M1)),
     ylab = "M1", xlab = "Data", cex.lab = 2.0, cex.axis = 1.5)

#sobrepondo esse gráfico com outro plot para a taxa selic

par(new = TRUE)
plot(ImpcAgre$Data, ImpcAgre$SELIC, type = "l",
     col = "cyan", axes = FALSE, xlab = "", ylab = "",
     ylim = c(min(ImpcAgre$SELIC),
              max(ImpcAgre$SELIC)))

#Criando um segundo eixo y para a taxa selic
axis(side = 4, at = pretty(range(ImpcAgre$SELIC)))
mtext("Taxa Selic (%)", side = 4, line = 3)



### Fazendo o mesmo para M2 e SELIC

plot(ImpcAgre$Data, ImpcAgre$M2, type = "l",
    col = "lawngreen", ylim = c(min(ImpcAgre$M2),
                                max(ImpcAgre$M2)),
    ylab = "M2", xlab = "Data", cex.lab = 2.0, cex.axis = 1.5)
par(new = TRUE)
plot(ImpcAgre$Data, ImpcAgre$SELIC, type = "l",
     col = "cyan", axes = FALSE, xlab = "", ylab = "",
     ylim = c(min(ImpcAgre$SELIC),
              max(ImpcAgre$SELIC)))
axis(side =  4, at = pretty(range(ImpcAgre$SELIC)))
mtext("Taxa Selic (%)", side = 4, line = 3)

# Fazendo o mesmo para M3 e SELIC

plot(ImpcAgre$Data, ImpcAgre$M3, type = "l",
     col = "yellow", ylim = c(min(ImpcAgre$M3),
                              max(ImpcAgre$M3)),
     ylab = "M3", xlab = "Data", cex.lab = 2.0, cex.axis = 1.5)
par(new = TRUE)
plot(ImpcAgre$Data, ImpcAgre$SELIC, type = "l",
     col = "cyan", axes = FALSE, xlab = "", ylab = "",
     ylim = c(min(ImpcAgre$SELIC),
              max(ImpcAgre$SELIC)))
axis(side =  4, at = pretty(range(ImpcAgre$SELIC)))
mtext("Taxa Selic (%)", side = 4, line = 3)

# Fazendo o mesmo para M4 e SELIC

plot(ImpcAgre$Data, ImpcAgre$M4, type = "l",
     col = "orange", ylim = c(min(ImpcAgre$M4),
                              max(ImpcAgre$M4)),
     ylab = "M4", xlab = "Data", cex.lab = 2.0, cex.axis = 1.5)
par(new = TRUE)
plot(ImpcAgre$Data, ImpcAgre$SELIC, type = "l",
     col = "cyan", axes = FALSE, xlab = "", ylab = "",
     ylim = c(min(ImpcAgre$SELIC),
              max(ImpcAgre$SELIC)))
axis(side =  4, at = pretty(range(ImpcAgre$SELIC)))
mtext("Taxa Selic (%)", side = 4, line = 3)

par(mfrow = c(1,1))

mtext("Comparação Entre os Agregados e a Selic", outer = TRUE, cex = 1.5, line = 2)


```
<br><br>




```{r echo = FALSE, message=FALSE, warning=FALSE, fig.width=4, fig.height=4, out.width='100%'}

#Criando uma gráfico plotly com M1 e IPCA 

p9 <- plot_ly() %>%
  add_lines(data = ImpcAgre, x = ~Data, y = ~M1, name = "M1", color = I("green")) %>%
  add_lines(data = ImpcAgre, x = ~Data, y = ~rollmeanIPCA3, name = "Média Móvel de 3 meses", color = I('purple2'),
            yaxis = "y2")

p9 <- p9 %>%
  layout(
    title = "M1 em relação ao IPCA",
    yaxis = list(title = "M1"),
    yaxis2 = list(
      title = "IPCA",
      overlaying = "y",
      side = "right"
    )
  )

p9

# Fazendo o mesmo para M2 e IPCA

p6 <- plot_ly() %>%
  add_lines(data = ImpcAgre, x = ~Data, y = ~M2, name = "M2", color = I("lawngreen")) %>%
  add_lines(data = ImpcAgre, x = ~Data, y = ~rollmeanIPCA3, name = "Média Móvel de 3 meses", color = I('purple2'),
            yaxis = "y2")

p6 <- p6 %>%
  layout(
    title = "M2 em relação ao IPCA",
    yaxis = list(title = "M2"),
    yaxis2 = list(
      title = "IPCA",
      overlaying = "y",
      side = "right"
    )
  )

p6

# Fazendo o mesmo para M3 e IPCA


p7 <- plot_ly() %>%
  add_lines(data = ImpcAgre, x = ~Data, y = ~M3, name = "M3", color = I("yellow")) %>%
  add_lines(data = ImpcAgre, x = ~Data, y = ~rollmeanIPCA3, name = "Média Móvel de 3 meses", color = I('purple2'),
            yaxis = "y2")

p7 <- p7 %>%
  layout(
    title = "M3 em relação ao IPCA",
    yaxis = list(title = "M3"),
    yaxis2 = list(
      title = "IPCA",
      overlaying = "y",
      side = "right"
    )
  )

p7

# Fazendo o mesmo para M4 e IPCA



p8 <- plot_ly() %>%
  add_lines(data = ImpcAgre, x = ~Data, y = ~M4, name = "M4", color = I("orange")) %>%
  add_lines(data = ImpcAgre, x = ~Data, y = ~rollmeanIPCA3, name = "Média Móvel de 3 meses", color = I('purple2'),
            yaxis = "y2")

p8 <- p8 %>%
  layout(
    title = "M4 em relação ao IPCA",
    yaxis = list(title = "M4"),
    yaxis2 = list(
      title = "IPCA",
      overlaying = "y",
      side = "right"
    )
  )

p8

```




```{r, echo=FALSE, message=FALSE, warning=FALSE}

 colnames(impcPib)[colnames(impcPib) == "Variação Percentual (%)"] <- "Variação_Percentual"


Plotpib2 <- plot_ly() %>%
  add_lines(data = impcPib, x = ~Data, y = ~PIB_Valores_Correntes_milhoes, name = "PIB valores correntes(milhões)", color = I("darkblue")) %>%
  add_lines(data = impcPib, x = ~Data, y = ~Variação_Percentual, name = "PIB em Variação Percentual (%)", yaxis = "y2", color = I("blue"))

# Configuração do layout com múltiplos eixos Y
Plotpib2 <- Plotpib2 %>%
  layout(
    autosize = F, # Desativa o dimensionamento automático
    width = 800,  # Largura do gráfico em pixels
    height = 600, # Altura do gráfico em pixels
    margin = list(l = 50, r = 50, b = 100, t = 100, pad = 4),
    title = "PIB e a variação nos anos próximos",
    yaxis = list(title = "PIB a valores correntes"),
    yaxis2 = list(
      title = "PIB em Variação Percentual (%)",
      overlaying = "y",
      side = "right",
      anchor = "free",
      position = 1.00
    )
  )

# Renderização do gráfico
Plotpib2
```

<br><br>






